
<% layout('layout/page') -%>
<% block('title', 'Hello'); -%>

<!-- tree -->
<div id="parentTreePages" style="border: 1px solid gray; height: 400px; overflow: auto;">
	<ul id="treePages" class="filetree treeview">
	</ul>
</div>

<script type="text/javascript">
	var treeObj =<%-JSON.stringify(treeJson)%>;
	function PageDropTarget(nodeSpan) {
		tabaga.DropTarget.apply(this, arguments);
    }
	
	// наследование таким образом не работает в IE8
	PageDropTarget.prototype = Object.create(tabaga.DropTarget.prototype);
	// переопределить accept
	PageDropTarget.prototype.accept = function(dragObject) {
		console.log("DropTarget: " + this + " accept DragObject: " + dragObject + " state: " + this.state);
		tabaga.DropTarget.prototype.accept.apply(this, arguments);  
	};
	
	var config = {
		urls: {
			feedChildNodesUrl: "pages/page",
			feedTreeScopeNodesUrl: "pages/pageTreeScope"
		},
	    onStartFeedChildNodes: function(nodeLi) {
	    	console.log("Start loading child");
	    },
		onSuccessFeedChildNodes: function(nodeLi) {
	    	console.log("Success loading child");
	    },
		onStartFeedTreeScopeNodes: function(nodeId) {
	    	console.log("Start loading tree scope");
	    },
		onSuccessFeedTreeScopeNodes: function(nodeLi) {
	    	console.log("Success loading tree scope");
	    },
	    dragAndDrop: {
	    	scrollContainer: jQuery("#parentTreePages")[0],
	    	DropTargetConstructor: PageDropTarget
	    }
	}
	
	jQuery("#treePages").createTreeControl("1", config, treeObj);
	
</script>
